<html>
  <head>
    <meta charset="UTF-8" />
    <title>Facemesh with Webcam!!</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"></script>
    <script
      src="https://unpkg.com/ml5@0.12.2/dist/ml5.min.js"
      type="text/javascript"
    ></script>

    <style></style>
  </head>

  <script>
    let facemesh;
    let video;
    let predictions = [];
    let margin = 50;

    function setup() {
      createCanvas(800, 600);
      video = createCapture(VIDEO);
      video.size(640, 480);

      facemesh = ml5.facemesh(video, modelReady);

      // This sets up an event that fills the global variable "predictions"
      // with an array every time new predictions are made
      facemesh.on("predict", (results) => {
        predictions = results;
      });

      // Hide the video element, and just show the canvas
      video.hide();
      background("purple");
    }

    function modelReady() {
      console.log("Model ready!");
    }

    function draw() {
      drawBackground();

      image(video, margin, margin, 640, 480);
      // We can call both functions to draw all keypoints
      drawKeypoints();
      drawForeground();
      if(key == '1'){
        fill(random(["red","green","blue"]))
        circle(random(width),random(height),random(10,20))
      }else if (key == '2'){
        strokeWeight(random(1,5))
        line(random(width),random(height),random(width),random(height))

      }
    }

    function drawForeground() {
      circle(random(width), random(height), map(mouseY, 0, height, 0, 100));
    }

    function drawBackground() {
      background("purple");
      rect(random(width), 0, map(mouseX, 0, width, 10, 100), height);
    }

    // A function to draw ellipses over the detected keypoints
    function drawKeypoints() {
      for (let i = 0; i < predictions.length; i += 1) {
        const keypoints = predictions[i].scaledMesh;

        // Draw facial keypoints.
        for (let j = 0; j < keypoints.length; j += 1) {
          const [x, y] = keypoints[j]; // 468 points
          push();
          translate(margin, margin);
          textAlign(CENTER, CENTER);

          if (j == 1) {
            text("😋", x, y); //tc
          } else if (j == 10) {
            text("🌎", x, y); //tc
          }
          else if (j == 220) {
            text("🐈", x, y); //Nightray
          }
          else if (j == 120){
            text("✅",x,y);//Jiarui
          }
          else if (j==242||j==462)
          {
            text("🐽",x,y);//Zhiyi
          }

            else if (j == 152)
              text ("👾",x,y); //jason
          }
            else if (j == 450){
              text("🦄",x,y);//eaden
            }
            else if(j == 104){
              text("✨",x,y);//eaden
            }
            else if (j == 29){
              text("🐣", x, y); //elaine
              
            else if (j == 69){
              text ("🐥", x, y); // irene
            }
            else if (j == 13){
              text("🍺",x,y);//Doris
            }
            else if (j == 410){
              text("🚬",x,y);//Anora
          }
            else if(j==5){
            //else if (j!=5){
              text("🤓😳🥺",y,x);//Allen 
            }

            else if (j == 352){
              text("🐹",x,y); // younghyun
            }

            else if(j==164){
              text("💅",x,y);
              //christy
            }
                
            else if(j==098){
                text("💁",x,y )//mia
                
            }
        else if(j==9){
          text("🌼",x,y); //Una
        }

        else if (j== 101){
          text("👽",x,y); // stella
        }
          else {
            if(key == 3){
              strokeWeight(1)
              stroke("red")
              noFill()
              square(x,y,30)
            }else{
            stroke("white");
            point(x, y);
              }
          }
         let jr_lefteye = [20, 22, 23, 24, 26, 110, 112, 113, 130, 189, 221,  223, 224, 225, 243]
        for(var i=0; i<jr_lefteye.length; q++){
          if(jr_lefteye[i] == j){
            text("😈",x,y);
          }
        }
        let mj_mouth = [409, 410, 436, 427, 411, 352, 105, 186, 216, 207, 187, 123]
        for(var i=0; i< mj_mouth.length; i++){
          if(mj_mouth[i] == j){
            text("🩸",x,y);
          }
        }
          pop();
        }
      }
    }
  </script>

  <body>
    <h1>Facemesh with Emojis / Texts / Shapes</h1>
  </body>
</html>
