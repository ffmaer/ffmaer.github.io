<!DOCTYPE html>
<html>
  <head>
    <title>p5.play p5.SceneManager collide</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.min.js"></script>
    <script src="./p5.play.js"></script>
    <script src="./p5.scenemanager.js"></script>
  </head>
  <body>
    <script>
      function preload() {
        bubble_ss = loadSpriteSheet(
          "https://cdn.glitch.com/dc122c87-3702-4e86-8f63-eea043d864ca%2Fezgif-6-54b25e0a96a3.png?v=1628769250046",
          100,
          100,
          10
        );
      }

      function setup() {
        createCanvas(400, 400);
        mgr = new SceneManager();
        mgr.addScene(circle_scene);
        mgr.addScene(square_scene);
        mgr.addScene(game_scene);
        mgr.showScene(game_scene);
        rectMode(CENTER);
        prev = null;
      }

      function keyPressed() {
        switch (key) {
          case "1":
            mgr.showScene(circle_scene);
            break;
          case "2":
            mgr.showScene(square_scene);
            break;
          case "3":
            mgr.showScene(game_scene);
            break;
          case "p":
            if (prev != null) mgr.showScene(prev);
            prev = null;
        }
        mgr.handleEvent("keyPressed");
      }

      function draw() {
        mgr.draw();
      }

      function circle_scene() {
        this.enter = function() {
          background(random(255));
          noStroke();
          fill(random(255));
          circle(width / 2, height / 2, 300);
          fill(random(255));
          circle(width / 2, height / 2, 200);
          fill(random(255));
          circle(width / 2, height / 2, 100);
        };
      }

      function square_scene() {
        this.enter = function() {
          console.log(mgr.scene.name);
          background(random(255));
          noStroke();
          fill(random(255));
          square(width / 2, height / 2, 300);
          fill(random(255));
          square(width / 2, height / 2, 200);
          fill(random(255));
          square(width / 2, height / 2, 100);
        };
      }

      function game_scene() {
        this.setup = function() {
          bubble_stand = loadAnimation(bubble_ss);
          bubble_stand.stop();
          bubble_move = loadAnimation(bubble_ss);
          bubble = createSprite(width / 2, height / 2, 45, 66);
          bubble.addAnimation("stand", bubble_stand);
          bubble.addAnimation("move", bubble_move);
          to_circle = createSprite(width / 2 - 100, height / 2, 50, 50);
          to_circle.draw = function() {
            circle(0, 0, 50);
          };
          to_square = createSprite(width / 2 + 100, height / 2, 50, 50);
          to_square.draw = function() {
            square(0, 0, 50);
          };
        };
        this.draw = function() {
          background("lavender");
          if (keyDown("a") || keyDown("s") || keyDown("d") || keyDown("w")) {
            bubble.changeAnimation("move");
          }

          if (
            keyWentUp("a") ||
            keyWentUp("s") ||
            keyWentUp("d") ||
            keyWentUp("w")
          ) {
            bubble.changeAnimation("stand");
          }

          if (keyDown("d")) {
            bubble.position.x += 3;
          }
          if (keyDown("a")) {
            bubble.position.x -= 3;
          }
          if (keyDown("s")) {
            bubble.position.y += 3;
          }
          if (keyDown("w")) {
            bubble.position.y -= 3;
          }
          bubble.collide(to_square, function() {
            prev = mgr.scene.fnScene;
            mgr.showScene(square_scene);
          });
          bubble.collide(to_circle, function() {
            prev = mgr.scene.fnScene;
            mgr.showScene(circle_scene);
          });
          drawSprites();
        };
      }
    </script>
    <pre>
      Reference:
      https://github.com/mveteanu/p5.SceneManager/blob/master/sample.html
    </pre>
  </body>
</html>
